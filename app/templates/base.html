<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Weave - Workflow Automation{% endblock %}</title>
    
    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>
    
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10/dist/htmx.min.js"></script>
    
    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.13.3/dist/cdn.min.js"></script>
    
    <!-- Custom styles -->
    <link rel="stylesheet" href="/static/css/main.css">
    <style>
        [x-cloak] { display: none !important; }
        
        /* Loading indicator styles */
        #loading-overlay {
            transition: opacity 200ms ease-in;
        }
        
        #loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        #loading-overlay:not(.hidden) {
            opacity: 1;
            pointer-events: auto;
        }
    </style>
    
    {% block extra_head %}{% endblock %}
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    {% include "components/header.html" %}
    
    <!-- Main content -->
    <main class="container mx-auto px-4 py-8">
        {% block content %}{% endblock %}
    </main>
    
    <!-- Footer -->
    {% include "components/footer.html" %}
    
    <!-- Modal root for HTMX -->
    <div id="modal-root"></div>
    
    <!-- Toast area -->
    <div id="toast-area" class="fixed top-4 right-4 z-50"></div>
    
    <!-- Loading indicator - only visible during HTMX requests -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 flex items-center space-x-3">
            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
            <span class="text-gray-700">Loading...</span>
        </div>
    </div>
    
    <!-- Custom JavaScript -->
    <script src="/static/js/app.js"></script>
    
    <!-- Debug script to ensure libraries are loaded -->
    <script>
        // Debug: Check if libraries are loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Base template: DOM loaded');
            
            if (typeof htmx !== 'undefined') {
                console.log('✅ HTMX loaded successfully in base template');
                
                // Set up HTMX loading indicators
                htmx.on('htmx:beforeRequest', function() {
                    console.log('HTMX request starting - showing loading overlay');
                    document.getElementById('loading-overlay').classList.remove('hidden');
                });
                
                htmx.on('htmx:afterRequest', function() {
                    console.log('HTMX request completed - hiding loading overlay');
                    document.getElementById('loading-overlay').classList.add('hidden');
                });
                
                htmx.on('htmx:responseError', function() {
                    console.log('HTMX request failed - hiding loading overlay');
                    document.getElementById('loading-overlay').classList.add('hidden');
                });
            } else {
                console.error('❌ HTMX failed to load in base template');
            }
            
            if (typeof Alpine !== 'undefined') {
                console.log('✅ Alpine.js loaded successfully in base template');
            } else {
                console.error('❌ Alpine.js failed to load in base template');
            }
            
            if (typeof tailwind !== 'undefined') {
                console.log('✅ TailwindCSS loaded successfully in base template');
            } else {
                console.log('ℹ️ TailwindCSS loaded in base template (no global object)');
            }
            
            // Test basic functionality
            console.log('Base template: Testing basic functionality...');
            
            // Test click events
            document.addEventListener('click', function(e) {
                console.log('Base template: Click event on:', e.target.tagName, e.target.className);
            });
            
            // Test form submission
            document.addEventListener('submit', function(e) {
                console.log('Base template: Form submit event on:', e.target);
            });
        });
    </script>
    
    {% block extra_scripts %}{% endblock %}
</body>
</html>
